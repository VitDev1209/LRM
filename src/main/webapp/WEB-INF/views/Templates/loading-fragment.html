<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="loadingScript">
        
        <div id="global-loader" class="loader-overlay" style="display: none;">
            <div class="bouncing-loader">
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>

        <style>
            /* The Full Screen Overlay */
            .loader-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(255, 255, 255, 0.9); /* White background */
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            /* The Bouncing Dots Container */
            .bouncing-loader {
                display: flex;
                justify-content: center;
            }

            /* The Individual Dots */
            .bouncing-loader > div {
                width: 16px;
                height: 16px;
                margin: 3px 6px;
                border-radius: 50%;
                background-color: #0d6efd; /* Bootstrap Primary Blue */
                opacity: 1;
                animation: bouncing-loader 0.6s infinite alternate;
            }

            /* The Animation Delays (So they jump one by one) */
            .bouncing-loader > div:nth-child(2) {
                animation-delay: 0.2s;
            }
            .bouncing-loader > div:nth-child(3) {
                animation-delay: 0.4s;
            }

            /* The Animation Keyframes */
            @keyframes bouncing-loader {
                to {
                    opacity: 0.1;
                    transform: translateY(-16px);
                }
            }
        </style>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                var loader = document.getElementById('global-loader');

                // Function to show loader
                function showLoader() {
                    loader.style.display = 'flex';
                }

                // A. Trigger on Form Submit
                document.querySelectorAll('form').forEach(form => {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity()) {
                            showLoader();
                        }
                    });
                });

                // B. Trigger on Link Click (Navigation)
                document.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', function(event) {
                        var href = link.getAttribute('href');
                        if (href && href !== '#' && !href.startsWith('javascript') && link.target !== '_blank') {
                            showLoader();
                        }
                    });
                });

                // C. Hide on Back Button
                window.addEventListener('pageshow', function(event) {
                    if (event.persisted) {
                        loader.style.display = 'none';
                    }
                });
            });
        </script>
    </div>
</body>
</html>